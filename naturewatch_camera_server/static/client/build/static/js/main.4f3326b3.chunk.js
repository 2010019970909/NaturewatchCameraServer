(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{113:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),o=n(28),i=n.n(o),l=(n(83),n(84),n(85),n(31)),r=n(25),c=n(9),u=n(10),h=n(5),d=n(12),p=n(11),g=n(128),m=n(129),v=n(130),S=n(62),f=n(14),E=n.n(f),y=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){return s.a.createElement("h1",null,"My Naturewatch")}}]),n}(s.a.Component),C=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"renderFeed",value:function(e){var t=e.status;return"active"===t?this.activeFeed():"inactive"===t?this.inactiveFeed():this.closingFeed(t)}},{key:"activeFeed",value:function(){return s.a.createElement("img",{src:"/api/feed",alt:"Camera feed"})}},{key:"inactiveFeed",value:function(){return s.a.createElement("div",{id:"inactive-feed"},s.a.createElement("span",{onClick:this.props.onClick},s.a.createElement("h2",null,"Preview paused ",s.a.createElement("br",null),"to save power. Tap to refresh.")))}},{key:"closingFeed",value:function(e){return s.a.createElement("div",{id:"closing-feed"},s.a.createElement("span",null,s.a.createElement("h2",null,"Preview ends ",s.a.createElement("br",null),"in ",e)))}},{key:"render",value:function(){return s.a.createElement("div",{className:"feed"},this.renderFeed(this.props))}}]),n}(s.a.Component),b=n(75),k=n(66),O=n(135),j=n(136),x=n(138),F=n(65),w=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){return s.a.createElement(x.a,{name:"sensitivity",value:this.props.value,onChange:this.props.onValueChange},s.a.createElement(F.a,{type:"radio",value:"less"},"Less"),s.a.createElement(F.a,{type:"radio",value:"default"},"Default"),s.a.createElement(F.a,{type:"radio",value:"more"},"More"))}}]),n}(s.a.Component),N=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).onShutterChange=a.onShutterChange.bind(Object(h.a)(a)),a.onShutterChangeEnd=a.onShutterChangeEnd.bind(Object(h.a)(a)),a.cameraShutterSpeeds={"1/30":33333,"1/40":25e3,"1/50":2e4,"1/60":16666,"1/80":12500,"1/100":1e4,"1/125":8e3,"1/160":6250,"1/200":5e3,"1/250":4e3,"1/320":3125,"1/400":2500,"1/500":2e3,"1/640":1563,"1/800":1250,"1/1000":1e3,"1/1250":800,"1/1600":625,"1/2000":500,"1/2500":400,"1/3200":313,"1/4000":250},a}return Object(u.a)(n,[{key:"renderShutterSpeedFraction",value:function(e){return"auto"===this.props.mode?"auto":Object.keys(this.cameraShutterSpeeds)[this.getIndexFromShutterSpeed(e)]}},{key:"getIndexFromShutterSpeed",value:function(e){for(var t=0;t<Object.keys(this.cameraShutterSpeeds).length;t++)if(Object.values(this.cameraShutterSpeeds)[t]===e)return t;return 0}},{key:"getShutterSpeedFromIndex",value:function(e){return Object.values(this.cameraShutterSpeeds)[e]}},{key:"onShutterChange",value:function(e){this.props.onShutterChange(this.getShutterSpeedFromIndex(e.target.value))}},{key:"onShutterChangeEnd",value:function(e){this.props.onShutterChangeEnd(this.getShutterSpeedFromIndex(e.target.value))}},{key:"renderDetailedSettings",value:function(){if("auto"!==this.props.mode)return s.a.createElement("div",null,s.a.createElement("label",{htmlFor:"shutter-speed",className:"shutter-speed-label"},"Fixed Shutter Speed: ",s.a.createElement("span",null,this.renderShutterSpeedFraction(this.props.shutterSpeed))),s.a.createElement("br",null),s.a.createElement("input",{type:"range",id:"shutter-speed",min:"0",max:Object.keys(this.cameraShutterSpeeds).length-1,step:"1",value:this.getIndexFromShutterSpeed(this.props.shutterSpeed),onChange:this.onShutterChange,onMouseUp:this.onShutterChangeEnd,onTouchEnd:this.onShutterChangeEnd}))}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(x.a,{name:"exposure",value:this.props.mode,onChange:this.props.onModeChange},s.a.createElement(F.a,{type:"radio",value:"auto"},"Auto"),s.a.createElement(F.a,{type:"radio",value:"off"},"Manual")),s.a.createElement("br",null),this.renderDetailedSettings())}}]),n}(s.a.Component),I=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e,a){var s;return Object(c.a)(this,n),(s=t.call(this,e,a)).onSensitivityChange=s.onSensitivityChange.bind(Object(h.a)(s)),s.onImageOrientationChange=s.onImageOrientationChange.bind(Object(h.a)(s)),s.onShutterChange=s.onShutterChange.bind(Object(h.a)(s)),s.onShutterChangeEnd=s.onShutterChangeEnd.bind(Object(h.a)(s)),s.onModeChange=s.onModeChange.bind(Object(h.a)(s)),s.state={isOpen:!1,settings:{rotation:null,exposure:{mode:"",iso:"",shutter_speed:""},sensitivity:""}},s}return Object(u.a)(n,[{key:"componentDidMount",value:function(){this.getSettings()}},{key:"getSettings",value:function(){var e=this;E.a.get("/api/settings").then(function(t){var n=t.data;e.setState({settings:n}),console.log("INFO: settings received."),console.log(e.state.settings)})}},{key:"postSettings",value:function(){var e=this;console.log(this.state.settings),E.a.post("api/settings",this.state.settings).then(function(t){console.log("INFO: settings sent.");var n=t.data;e.setState({settings:n},function(){console.log("INFO: Updated settings"),console.log(e.state.settings)})})}},{key:"renderBackButton",value:function(){return this.props.isOpen?s.a.createElement(b.a,{variant:"secondary",onClick:this.props.onClose,"aria-controls":"collapse-settings","aria-expanded":"false",className:"short"},"Back"):null}},{key:"onSensitivityChange",value:function(e){var t=this;console.log("INFO: Received sensitivity value"),console.log(e);var n=this.state.settings;console.log("Current settings: "),console.log(n),n.sensitivity=e,console.log("Changed settings: "),console.log(n),this.setState({settings:n},function(){console.log("INFO: Changed sensitivity."),console.log(t.state.settings),t.postSettings()})}},{key:"onImageOrientationChange",value:function(){var e=this,t=this.state.settings;t.rotation=!t.rotation,this.setState({settings:t},function(){console.log("INFO: Changed orientation."),e.postSettings()})}},{key:"onShutterChange",value:function(e){var t=this.state.settings;t.exposure.shutter_speed=e,this.setState({settings:t})}},{key:"onShutterChangeEnd",value:function(e){var t=this,n=this.state.settings;n.exposure.shutter_speed=e,this.setState({settings:n},function(){console.log("INFO: Changed shutter speed."),t.postSettings()})}},{key:"onModeChange",value:function(e){var t=this,n=this.state.settings;n.exposure.mode=e,this.setState({settings:n},function(){console.log("INFO: Changed exposure mode"),t.postSettings()})}},{key:"render",value:function(){return s.a.createElement("div",{className:"settings"},s.a.createElement(b.a,{variant:"secondary",onClick:this.props.onOpen,"aria-controls":"collapse-settings","aria-expanded":this.props.isOpen,className:"settings-button"},"Settings"),s.a.createElement(k.a,{in:this.props.isOpen},s.a.createElement(O.a,null,s.a.createElement(j.a,null,s.a.createElement(O.a.Toggle,{as:j.a.Header,eventKey:0},"Sensitivity"),s.a.createElement(O.a.Collapse,{eventKey:0},s.a.createElement(j.a.Body,null,s.a.createElement(w,{onValueChange:this.onSensitivityChange,value:this.state.settings.sensitivity})))),s.a.createElement(j.a,null,s.a.createElement(O.a.Toggle,{as:j.a.Header,eventKey:1},"Image Orientation"),s.a.createElement(O.a.Collapse,{eventKey:1},s.a.createElement(j.a.Body,null,s.a.createElement(b.a,{variant:"primary",onClick:this.onImageOrientationChange},"Flip 180")))),s.a.createElement(j.a,null,s.a.createElement(O.a.Toggle,{as:j.a.Header,eventKey:2},"Exposure"),s.a.createElement(O.a.Collapse,{eventKey:2},s.a.createElement(j.a.Body,null,s.a.createElement(N,{mode:this.state.settings.exposure.mode,shutterSpeed:this.state.settings.exposure.shutter_speed,onShutterChange:this.onShutterChange,onShutterChangeEnd:this.onShutterChangeEnd,onModeChange:this.onModeChange})))))),this.renderBackButton())}}]),n}(s.a.Component),B=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).handleClick=a.handleClick.bind(Object(h.a)(a)),a}return Object(u.a)(n,[{key:"renderText",value:function(){return this.props.sessionStatus===this.props.type?s.a.createElement("span",null,"Stop "+this.props.type+" capture"):s.a.createElement("span",null,"Start "+this.props.type+" capture")}},{key:"handleClick",value:function(){this.props.onButtonClick(this.props.type)}},{key:"render",value:function(){return s.a.createElement(b.a,{size:"lg",className:"startsession",onClick:this.handleClick,active:this.props.sessionStatus===this.props.type,disabled:"inactive"!==this.props.sessionStatus&&this.props.sessionStatus!==this.props.type},this.renderText())}}]),n}(s.a.Component),M=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).idleTimer=null,a.onSessionButtonClick=a.onSessionButtonClick.bind(Object(h.a)(a)),a.onIdle=a.onIdle.bind(Object(h.a)(a)),a.handleFeedRefresh=a.handleFeedRefresh.bind(Object(h.a)(a)),a.onSettingsOpen=a.onSettingsOpen.bind(Object(h.a)(a)),a.onSettingsClose=a.onSettingsClose.bind(Object(h.a)(a)),a.state={feedStatus:"active",sessionStatus:{mode:"inactive",time_started:0},isSettingsOpen:!1},a}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this;E.a.get("/api/session").then(function(t){var n=t.data;e.setState({sessionStatus:n}),console.log("INFO: status received."),console.log(e.state.sessionStatus)});var t=Date.now()/1e3;E.a.post("/api/time/"+t).then(function(e){var n=e.data;console.log("INFO: Sent time "+t+" to camera."),console.log(n)})}},{key:"captureStatus",value:function(){return"inactive"===this.state.sessionStatus.mode?s.a.createElement("p",{className:"feed-status"},"Capture is ",s.a.createElement("u",null,"off")):s.a.createElement("p",{className:"feed-status"},"Capture is ",s.a.createElement("u",null,"on"))}},{key:"getSessionButtonText",value:function(e){"photo"===e&&(e="image");var t=this.state.sessionStatus.mode;return"photo"===t&&(e="image"),t===e?"Stop "+e+" Capture":"Start "+e+" Capture"}},{key:"formatTime",value:function(e){var t=e.getFullYear().toString(),n="";e.getMonth()+1<10?n="0"+(e.getMonth()+1).toString():n+=(e.getMonth()+1).toString();return t+"-"+n+"-"+(e.getDate()<10?"0"+e.getDate().toString():e.getDate().toString())+" "+(e.getHours()<10?"0"+e.getHours().toString():e.getHours().toString())+":"+(e.getMinutes()<10?"0"+e.getMinutes().toString():e.getMinutes().toString())+":"+(e.getSeconds()<10?"0"+e.getSeconds().toString():e.getSeconds().toString())}},{key:"onSessionButtonClick",value:function(e){var t=this;"inactive"===this.state.sessionStatus.mode?E.a.post("/api/session/start/"+e).then(function(e){t.setState({sessionStatus:e.data},function(){console.log(t.state.sessionStatus)})}).catch(function(){console.log("ERROR: POST request failed whilst opening session.")}):E.a.post("/api/session/stop").then(function(e){t.setState({sessionStatus:e.data},function(){console.log(t.state.sessionStatus)})}).catch(function(){console.log("ERROR: POST request failed whilst closing session.")})}},{key:"onIdle",value:function(){console.log("INFO: Feed status timeout."),this.setState({feedStatus:"inactive"})}},{key:"handleFeedRefresh",value:function(){console.log("INFO: Feed refreshed."),this.setState({feedStatus:"active"})}},{key:"onSettingsOpen",value:function(){this.setState({isSettingsOpen:!0})}},{key:"onSettingsClose",value:function(){this.setState({isSettingsOpen:!1})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"index"},s.a.createElement(g.a,null,s.a.createElement(m.a,null,s.a.createElement(v.a,null,s.a.createElement(y,null))),s.a.createElement(m.a,null,s.a.createElement(v.a,{sm:8},s.a.createElement(C,{status:this.state.feedStatus,onClick:this.handleFeedRefresh}),this.captureStatus()),s.a.createElement(v.a,{sm:4},!this.state.isSettingsOpen&&s.a.createElement(m.a,null,s.a.createElement(v.a,{xs:6},s.a.createElement(B,{type:"video",onButtonClick:this.onSessionButtonClick,sessionStatus:this.state.sessionStatus.mode})),s.a.createElement(v.a,{xs:6},s.a.createElement(B,{type:"photo",onButtonClick:this.onSessionButtonClick,sessionStatus:this.state.sessionStatus.mode}))),s.a.createElement(I,{isOpen:this.state.isSettingsOpen,onOpen:this.onSettingsOpen,onClose:this.onSettingsClose}),!this.state.isSettingsOpen&&s.a.createElement(l.b,{to:"/gallery",className:"btn btn-secondary"},"Gallery")))),s.a.createElement(S.a,{ref:function(t){e.idleTimer=t},element:document,onIdle:this.onIdle,debounce:250,timeout:6e4}))}}]),n}(s.a.Component),D=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){return s.a.createElement("div",{className:"content-type-selector float-right"},s.a.createElement("p",null,"Photo"),s.a.createElement("label",{className:"switch"},s.a.createElement("input",{type:"checkbox",onClick:this.props.onToggle}),s.a.createElement("span",{className:"slider round"})),s.a.createElement("p",null,"Video"))}}]),n}(s.a.Component),T=n(63),A=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"renderButtons",value:function(){return this.props.isSelectActive?this.renderDeleteButtons():this.renderSelectButton()}},{key:"renderSelectButton",value:function(){return s.a.createElement(b.a,{variant:"primary",onClick:this.props.onSelectStart},"Select")}},{key:"renderDeleteButtons",value:function(){return s.a.createElement(T.a,{"aria-label":"delete"},s.a.createElement(b.a,{variant:"primary",onClick:this.props.onDeleteAll},"Delete All"),s.a.createElement(b.a,{variant:"primary",onClick:this.props.onDelete},"Delete"),s.a.createElement(b.a,{variant:"primary",onClick:this.props.onClearSelection},"Cancel"))}},{key:"render",value:function(){return s.a.createElement("div",{className:"content-select"},this.renderButtons())}}]),n}(s.a.Component),V=n(134),P=n(68),R=n.n(P),H=n(131),_=n(132),K=n(137),W=n(133),U=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).handleThumbnailClick=a.handleThumbnailClick.bind(Object(h.a)(a)),a.handleModalExit=a.handleModalExit.bind(Object(h.a)(a)),a.state={activeContent:"",isModalShowing:!1},a}return Object(u.a)(n,[{key:"handleThumbnailClick",value:function(e){this.props.isSelectActive?this.props.onContentClick(e):this.setState({activeContent:e.src,isModalShowing:!0},function(){console.log("Updated active content with value "+e.src)})}},{key:"handleModalExit",value:function(){this.setState({activeContent:"",isModalShowing:!1})}},{key:"renderItem",value:function(e,t){return s.a.createElement(K.a,{key:t,cols:1},s.a.createElement("div",{key:e.thumbnail,className:"gallery-thumbnail"},s.a.createElement(R.a,null,s.a.createElement("img",{alt:"Captured by Naturewatch Camera",src:e.thumbnail,onClick:this.handleThumbnailClick.bind(this,e)})),this.renderSelectIcon(e)))}},{key:"renderSelectIcon",value:function(e){if(this.props.isSelectActive)return e.selected?s.a.createElement(H.a,null):null}},{key:"renderModal",value:function(){return s.a.createElement(V.a,{show:this.state.isModalShowing,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,className:"modal-gallery-content",onHide:this.handleModalExit},s.a.createElement(V.a.Body,null,this.renderModalContent()),s.a.createElement(V.a.Footer,null,this.state.activeContent.endsWith(".jpg")&&s.a.createElement("p",{className:"mr-auto"},"Press and hold photo to download."),s.a.createElement(b.a,{variant:"primary",onClick:this.handleModalExit},s.a.createElement(_.a,null))))}},{key:"renderModalContent",value:function(){return this.state.activeContent.endsWith(".mp4")?s.a.createElement("video",{controls:!0},s.a.createElement("source",{src:this.state.activeContent,type:"video/mp4"}),"Your browser does not support the video tag."):s.a.createElement("img",{alt:"",src:this.state.activeContent})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"gallery-grid"},s.a.createElement(W.a,{cellHeight:100,className:"gallery-grid-list",cols:3},this.props.content.map(function(t,n){return e.renderItem(t,n)})),this.renderModal())}}]),n}(s.a.Component),q=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e,a){var s;return Object(c.a)(this,n),(s=t.call(this,e,a)).handleBackButton=s.handleBackButton.bind(Object(h.a)(s)),s.onContentTypeChange=s.onContentTypeChange.bind(Object(h.a)(s)),s.onSelectStart=s.onSelectStart.bind(Object(h.a)(s)),s.onDelete=s.onDelete.bind(Object(h.a)(s)),s.onDeleteAll=s.onDeleteAll.bind(Object(h.a)(s)),s.onClearSelection=s.onClearSelection.bind(Object(h.a)(s)),s.onContentSelect=s.onContentSelect.bind(Object(h.a)(s)),s.state={content:[],showingVideos:!1,isSelectActive:!1},s}return Object(u.a)(n,[{key:"componentDidMount",value:function(){this.getPhotos()}},{key:"getPhotos",value:function(){var e=this;E.a.get("/data/photos").then(function(t){var n=[],a=0;t.data.forEach(function(e){n.push({src:"/data/photos/"+e,thumbnail:"/data/photos/thumb_"+e,index:a,selected:!1}),a++}),e.setState({content:n},function(){console.log(e.state.content)})})}},{key:"getVideos",value:function(){var e=this;E.a.get("/data/videos").then(function(t){var n=[],a=0;t.data.forEach(function(e){n.push({src:"/data/videos/"+e,thumbnail:"/data/videos/thumb_"+e.substr(0,e.lastIndexOf("."))+".jpg",index:a,selected:!1}),a++}),e.setState({content:n},function(){console.log(e.state.content)})})}},{key:"handleBackButton",value:function(){this.context.router.history.push("/")}},{key:"onContentTypeChange",value:function(){this.state.showingVideos?(this.getPhotos(),this.setState({showingVideos:!1})):(this.getVideos(),this.setState({showingVideos:!0}))}},{key:"onSelectStart",value:function(){this.setState({isSelectActive:!0})}},{key:"onDelete",value:function(){for(var e=this,t=this.state.content,n=function(n){t[n].selected&&E.a.delete(t[n].src).then(function(a){E.a.delete(t[n].thumbnail).then(function(a){console.log("Deleted "+t[n].src),e.state.showingVideos?e.getVideos():e.getPhotos()})})},a=0;a<t.length;a++)n(a)}},{key:"onDeleteAll",value:function(){for(var e=this,t=this.state.content,n=function(n){E.a.delete(t[n].thumbnail).then(function(a){E.a.delete(t[n].src).then(function(a){console.log("Deleted "+t[n].src),e.state.showingVideos?e.getVideos():e.getPhotos()})})},a=0;a<t.length;a++)n(a)}},{key:"onClearSelection",value:function(){var e=this;this.setState({isSelectActive:!1},function(){e.state.showingVideos?e.getVideos():e.getPhotos()})}},{key:"onContentSelect",value:function(e){var t=this;console.log(e.index);for(var n=this.state.content,a=0;a<n.length;a++)if(n[a].index===e.index){n[a].selected=!n[a].selected;break}this.setState({content:n},function(){console.log(t.state.content)})}},{key:"render",value:function(){return s.a.createElement(g.a,null,s.a.createElement(m.a,null,s.a.createElement(v.a,null,s.a.createElement(y,null))),s.a.createElement(m.a,null,s.a.createElement(v.a,null,s.a.createElement(D,{onToggle:this.onContentTypeChange}))),s.a.createElement(m.a,null,s.a.createElement(v.a,{xs:6},s.a.createElement(l.b,{to:"/",className:"btn btn-secondary"},"Back")),s.a.createElement(v.a,{xs:6},s.a.createElement(A,{onSelectStart:this.onSelectStart,onDelete:this.onDelete,onDeleteAll:this.onDeleteAll,onClearSelection:this.onClearSelection,isSelectActive:this.state.isSelectActive}))),s.a.createElement(m.a,null,s.a.createElement(v.a,null,s.a.createElement(U,{content:this.state.content,onContentClick:this.onContentSelect,isSelectActive:this.state.isSelectActive}))))}}]),n}(s.a.Component);var z=function(){return s.a.createElement("div",{className:"App"},s.a.createElement(l.a,null,s.a.createElement(r.a,{path:"/",exact:!0,component:M}),s.a.createElement(r.a,{path:"/gallery",exact:!0,component:q})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(s.a.createElement(z,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},78:function(e,t,n){e.exports=n(113)},84:function(e,t,n){},85:function(e,t,n){}},[[78,1,2]]]);
//# sourceMappingURL=main.4f3326b3.chunk.js.map